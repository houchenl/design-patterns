# 享元模式

> Flyweight在拳击比赛中指最轻量级，即“蝇量级”或“雨量级”，这里选择使用“享元模式”的意译，是因为这样更能反映模式的用意。享元模式是对象的结构模式。享元模式以共享的方式高效地支持大量的细粒度对象。  

## 思想
享元模式是设计模式中少数几个以提交系统性能为目的的模式之一。  

如果系统中存在的对象过多时，会导致系统的性能下降，对于这样的问题最直接的办法就是减少系统中对象的个数。享元模式提供了一种解决方案，使用共享技术实现相同或者相似对象的重用。  

它的核心思想是：如果在一个系统中存在多个相同的对象，那么只需要共享一份对象的拷贝，而不必每一次都创建新的对象。  

在享元模式中，由于需要构造和维护这些可以共享的对象，因此，会出现一个工厂类，用于维护和创建对象。  

## 定义
享元模式就是运用共享技术有效地支持大量细粒度对象的复用。系统使用少量对象，而且这些对象都比较相似，状态变化小，可以实现对象的多次复用。  

共享模式是支持大量细粒度对象的复用，所以享元模式要求能够共享的对象必须是细粒度对象。  

在了解享元模式之前我们先要了解两个概念：内部状态、外部状态。  
内部状态：在享元对象内部不随外界环境改变而改变的共享部分。  
外部状态：随着环境的改变而改变，不能够共享的状态就是外部状态。  
由于享元模式区分了内部状态和外部状态，所以我们可以通过设置不同的外部状态使得相同的对象可以具备一些不同的特性，而内部状态设置为相同部分。在我们的程序设计过程中，我们可能会需要大量的细粒度对象来表示对象，如果这些对象除了几个参数不同外其他部分都相同，这个时候我们就可以利用享元模式来大大减少应用程序当中的对象。如何利用享元模式呢？这里我们只需要将他们少部分的不同的部分当做参数移动到类实例的外部去，然后再方法调用的时候将他们传递过来就可以了。这里也就说明了一点：内部状态存储于享元对象内部，而外部状态则应该由客户端来考虑。  


## 结构
![](https://yulinwork.oss-cn-hangzhou.aliyuncs.com/patterns/flyweight.png)
享元模式主要角色由享元工厂、抽象享元、具体享元和客户端几部分组成。  

**享元工厂：** 创建具体享元类，维护相同的享元对象，保证相同的享元对象可以被系统共享。内部使用类似单例的方式持有享元对象集合，当请求的对象存在时，返回对象，不存在时，创建对象并保存在集合中。  

**抽象享元：** 抽象享元类。所有具体享元类的超类或者接口，通过这个接口，Flyweight可以接受并作用于外部专题  

**具体享元：** 具体享元类。指定内部状态，为内部状态增加存储空间。  

享元模式的核心在于享元工厂类，享元工厂类的作用在于提供一个用于存储享元对象的享元池，用户需要对象时，首先从享元池中获取，如果享元池中不存在，则创建一个新的享元对象返回给用户，并在享元池中保存该新增对象。  

## 优点
1. 可以减少系统中对象的个数，节省创建相似对象的开销，节省内存；
2. 享元模式由于使用了外部状态，外部状态相对独立，不会影响到内部状态，所以享元模式使得享元对象能够在不同的环境被共享。

## 缺点
1. 由于享元模式需要区分外部状态和内部状态，使得应用程序在某种程度上来说更加复杂化了。

## 总结
1. 享元模式可以极大地减少系统中对象的数量。但是它可能会引起系统的逻辑更加复杂化。
2. 享元模式的核心在于享元工厂，它主要用来确保合理地共享享元对象。
3. 内部状态为不变共享部分，存储于享元享元对象内部，而外部状态是可变部分，它应当由客户端来负责。